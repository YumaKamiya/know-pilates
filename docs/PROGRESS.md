# know-pilates å®Ÿè£…é€²æ—çŠ¶æ³

æœ€çµ‚æ›´æ–°: 2025-11-29

## å®Ÿè£…çŠ¶æ³ã‚µãƒãƒªãƒ¼

| æ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒª | å®Œæˆåº¦ | çŠ¶æ…‹ |
|------------|-------|------|
| ä¼šå“¡äºˆç´„UI | 100% | âœ… å®Œæˆ |
| ãƒã‚±ãƒƒãƒˆæ¶ˆè²»ãƒ­ã‚¸ãƒƒã‚¯ | 90% | âš ï¸ ãƒã‚°ã‚ã‚Šï¼ˆæœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ä¸å‚™ï¼‰ |
| ç®¡ç†ç”»é¢ | 95% | âš ï¸ äºˆç´„ä¸€è¦§ãƒšãƒ¼ã‚¸æœªå®Ÿè£… |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ | 100% | âœ… å®Œæˆ |
| Googleé€£æº | 95% | âš ï¸ Gmail API 7æ—¥æœŸé™å•é¡Œ |
| ãƒ†ã‚¹ãƒˆç’°å¢ƒ | 0% | âŒ æœªå®Ÿè£… |

---

## è©³ç´°å®Ÿè£…çŠ¶æ³

### 1. ä¼šå“¡æ©Ÿèƒ½ (100%å®Œæˆ)

#### èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† âœ…
- [x] ä¼šå“¡ç™»éŒ²ï¼ˆé€šå¸¸ï¼‰
- [x] ä¼šå“¡ç™»éŒ²ï¼ˆæ‹›å¾…ãƒˆãƒ¼ã‚¯ãƒ³çµŒç”±ï¼‰
- [x] ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- [x] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ä»¶ï¼ˆ8æ–‡å­—ä»¥ä¸Šï¼‰
- [x] ãƒ¡ãƒ¼ãƒ«é‡è¤‡ãƒã‚§ãƒƒã‚¯

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/member/register/page.tsx`
- `src/app/member/register/invitation/page.tsx`
- `src/app/member/login/page.tsx`
- `src/app/api/auth/register/route.ts`

#### äºˆç´„æ©Ÿèƒ½ âœ…
- [x] ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIã§ã‚¹ãƒ­ãƒƒãƒˆé¸æŠ
- [x] äºˆç´„ä½œæˆï¼ˆæœˆãƒ—ãƒ©ãƒ³/å›æ•°åˆ¸å¯¾å¿œï¼‰
- [x] äºˆç´„ä¸€è¦§è¡¨ç¤º
- [x] äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆ2æ™‚é–“å‰ã¾ã§ï¼‰
- [x] ãƒã‚±ãƒƒãƒˆæ®‹é«˜è¡¨ç¤º
- [x] Google CalendaråŒæœŸ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/member/reservation/page.tsx` - äºˆç´„ä½œæˆ
- `src/app/member/reservations/page.tsx` - äºˆç´„ä¸€è¦§
- `src/app/member/dashboard/page.tsx` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- `src/app/api/member/reservations/route.ts` - äºˆç´„API
- `src/app/api/member/reservations/[id]/route.ts` - ã‚­ãƒ£ãƒ³ã‚»ãƒ«API
- `src/components/member/MobileCalendar.tsx` - ãƒ¢ãƒã‚¤ãƒ«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼

---

### 2. ç®¡ç†ç”»é¢ (95%å®Œæˆ)

#### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ âœ…
- [x] KPIè¡¨ç¤ºï¼ˆä¼šå“¡æ•°ã€äºˆç´„æ•°ã€ç©ºãæ æ•°ï¼‰
- [x] ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/admin/dashboard/page.tsx`

#### ä¼šå“¡ç®¡ç† âœ…
- [x] ä¼šå“¡ä¸€è¦§è¡¨ç¤º
- [x] æ¤œç´¢æ©Ÿèƒ½ï¼ˆåå‰ãƒ»ãƒ¡ãƒ¼ãƒ«ï¼‰
- [x] æ–°è¦ä¼šå“¡ç™»éŒ²
- [x] ä¼šå“¡æ‹›å¾…ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰
- [x] ä¼šå“¡è©³ç´°ãƒšãƒ¼ã‚¸
- [x] ä¼šå“¡æƒ…å ±ç·¨é›†
- [x] ãƒã‚±ãƒƒãƒˆä»˜ä¸ãƒ»æ¶ˆè²»ãƒ»è¿”å´
- [x] ãƒ—ãƒ©ãƒ³å‰²ã‚Šå½“ã¦

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/admin/members/page.tsx`
- `src/app/admin/members/[id]/page.tsx`
- `src/app/api/admin/members/route.ts`
- `src/app/api/admin/invitations/route.ts`

#### ãƒ—ãƒ©ãƒ³ç®¡ç† âœ…
- [x] ãƒ—ãƒ©ãƒ³ä¸€è¦§è¡¨ç¤º
- [x] ãƒ—ãƒ©ãƒ³ä½œæˆ
- [x] ãƒ—ãƒ©ãƒ³ç·¨é›†
- [x] æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/admin/plans/page.tsx`
- `src/app/api/admin/plans/route.ts`

#### ã‚¹ãƒ­ãƒƒãƒˆç®¡ç† âœ…
- [x] é€±é–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼
- [x] ã‚¹ãƒ­ãƒƒãƒˆä½œæˆï¼ˆGoogle Calendaré€£æºï¼‰
- [x] ã‚¹ãƒ­ãƒƒãƒˆå‰Šé™¤
- [x] ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼ˆ3æ—¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‰

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/admin/slots/page.tsx`
- `src/app/api/admin/slots/route.ts`
- `src/components/admin/MobileSlotCalendar.tsx`

#### äºˆç´„ç®¡ç† âŒ æœªå®Ÿè£…
- [ ] äºˆç´„ä¸€è¦§è¡¨ç¤º
- [ ] æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- [ ] ç®¡ç†è€…ã«ã‚ˆã‚‹äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«

**å¿…è¦ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/admin/reservations/page.tsx` ï¼ˆæœªä½œæˆï¼‰
- `src/app/api/admin/reservations/route.ts` ï¼ˆæœªä½œæˆï¼‰

---

### 3. ãƒã‚±ãƒƒãƒˆãƒ»ãƒ—ãƒ©ãƒ³ç®¡ç† (90%å®Œæˆ)

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ âœ…
- [x] `plans` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæœˆãƒ—ãƒ©ãƒ³/å›æ•°åˆ¸ï¼‰
- [x] `member_plans` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆä¼šå“¡ã¨ãƒ—ãƒ©ãƒ³ã®é–¢é€£ä»˜ã‘ï¼‰
- [x] `ticket_logs` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒã‚±ãƒƒãƒˆæ“ä½œå±¥æ­´ï¼‰
- [x] `member_ticket_balance_valid` ãƒ“ãƒ¥ãƒ¼ï¼ˆæœ‰åŠ¹æœŸé™è€ƒæ…®ï¼‰
- [x] `can_make_reservation` é–¢æ•°ï¼ˆäºˆç´„å¯èƒ½ãƒã‚§ãƒƒã‚¯ï¼‰

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `supabase/migrations/00001_create_tables.sql`
- `supabase/migrations/00005_reservation_limits.sql`

#### APIå®Ÿè£… âš ï¸ ãƒã‚°ã‚ã‚Š
- [x] ãƒã‚±ãƒƒãƒˆä»˜ä¸ãƒ»æ¶ˆè²»API
- [x] äºˆç´„ä½œæˆæ™‚ã®ãƒã‚±ãƒƒãƒˆæ¶ˆè²»
- [x] ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®ãƒã‚±ãƒƒãƒˆè¿”å´
- [x] ãƒ—ãƒ©ãƒ³å‰²ã‚Šå½“ã¦
- [x] æ¥½è¦³çš„ãƒ­ãƒƒã‚¯ï¼ˆä¸¦è¡Œåˆ¶å¾¡ï¼‰
- [x] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹
- [ ] **ãƒã‚°**: æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ãŒä¸å®Œå…¨ï¼ˆHIGHå„ªå…ˆåº¦ï¼‰

**å•é¡Œç®‡æ‰€**:
- `src/app/api/admin/tickets/route.ts:60` - `member_ticket_balance` ã‚’ä½¿ç”¨ï¼ˆæœ‰åŠ¹æœŸé™æœªè€ƒæ…®ï¼‰
- æ­£ã—ãã¯ `member_ticket_balance_valid` ã‚’ä½¿ç”¨ã™ã¹ã

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/api/admin/tickets/route.ts` âš ï¸
- `src/app/api/admin/member-plans/route.ts`
- `src/app/api/member/reservations/route.ts`

---

### 4. Googleé€£æº (95%å®Œæˆ)

#### Google Calendar âœ…
- [x] ã‚¹ãƒ­ãƒƒãƒˆä½œæˆæ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
- [x] äºˆç´„æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°ï¼ˆã€Œã€äºˆç´„æ¸ˆã€‘ä¼šå“¡åæ§˜ã€ï¼‰
- [x] ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°ï¼ˆã€Œã€ç©ºãæ ã€‘ã€ï¼‰
- [x] ã‚¹ãƒ­ãƒƒãƒˆå‰Šé™¤æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/lib/google/calendar.ts`

#### Google Sheets âœ…
- [x] ä½“é¨“äºˆç´„ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•è¨˜éŒ²

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/lib/google/sheets.ts`

#### Gmail API âš ï¸ 7æ—¥æœŸé™å•é¡Œ
- [x] æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- [x] äºˆç´„ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡
- [x] ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- [ ] **å•é¡Œ**: æœªå…¬é–‹ã‚¢ãƒ—ãƒªã®ãŸã‚7æ—¥ã§ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œ

**å¯¾ç­–**: ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ã§æœŸé™å»¶é•·ï¼ˆPhase 4ã§å®Ÿæ–½äºˆå®šï¼‰

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/lib/google/gmail.ts`

---

### 5. ãƒ†ã‚¹ãƒˆ (0%æœªå®Ÿè£…)

#### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ âŒ
- [ ] API Routeãƒ†ã‚¹ãƒˆ
- [ ] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

#### E2Eãƒ†ã‚¹ãƒˆ âŒ
- [ ] ä¸»è¦ãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

**å¿…è¦ãƒ•ã‚¡ã‚¤ãƒ«**:
- `jest.config.js` ï¼ˆæœªä½œæˆï¼‰
- `jest.setup.js` ï¼ˆæœªä½œæˆï¼‰
- `src/__tests__/` ï¼ˆæœªä½œæˆï¼‰

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…çŠ¶æ³

### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ä¿è­· âœ…
- [x] CSRFå¯¾ç­–ï¼ˆOrigin/Refereræ¤œè¨¼ï¼‰
- [x] ç®¡ç†è€…ãƒšãƒ¼ã‚¸ä¿è­·ï¼ˆ/admin, /api/adminï¼‰
- [x] ä¼šå“¡ãƒšãƒ¼ã‚¸ä¿è­·ï¼ˆ/member, /api/memberï¼‰

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/middleware.ts`

### Row Level Security (RLS) âœ…
- [x] ä¼šå“¡ã¯è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- [x] ãƒ—ãƒ©ãƒ³ãƒ»ã‚¹ãƒ­ãƒƒãƒˆæƒ…å ±ã¯å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å‚ç…§å¯èƒ½

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
- `supabase/migrations/00002_add_rls_policies.sql`

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- Next.js 16.0.4 (App Router)
- React 19.2.0
- Tailwind CSS v4
- TypeScript 5

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- Supabase (PostgreSQL + Auth)
- Google APIs (Calendar, Sheets, Gmail)

### çŠ¶æ…‹ç®¡ç†ãƒ»ãƒ•ã‚©ãƒ¼ãƒ 
- React Hook Form 7.66.1
- Zod 4.1.13ï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

### æ—¥ä»˜å‡¦ç†
- date-fns 4.1.0
- date-fns-tz 3.2.0

---

## æ—¢çŸ¥ã®å•é¡Œãƒ»æœªå®Ÿè£…æ©Ÿèƒ½

### HIGHå„ªå…ˆåº¦ ğŸ”´
1. **ãƒã‚±ãƒƒãƒˆæœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ã®ä¸å‚™**
   - å ´æ‰€: `src/app/api/admin/tickets/route.ts:60`
   - å½±éŸ¿: æœŸé™åˆ‡ã‚Œãƒã‚±ãƒƒãƒˆãŒæ¶ˆè²»ã§ãã¦ã—ã¾ã†
   - å¯¾ç­–: `member_ticket_balance_valid` ã«ä¿®æ­£ï¼ˆPhase 1ã§å®Ÿæ–½ï¼‰

### MEDIUMå„ªå…ˆåº¦ ğŸŸ¡
2. **ç®¡ç†ç”»é¢äºˆç´„ä¸€è¦§ãƒšãƒ¼ã‚¸æœªå®Ÿè£…**
   - å¿…è¦ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/admin/reservations/page.tsx`
   - å¯¾ç­–: Phase 3ã§å®Ÿè£…

3. **Gmail API 7æ—¥æœŸé™å•é¡Œ**
   - å½±éŸ¿: 7æ—¥ã”ã¨ã«èªè¨¼ãŒåˆ‡ã‚Œã‚‹
   - å¯¾ç­–: ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ï¼ˆPhase 4ã§å®Ÿæ–½ï¼‰

### LOWå„ªå…ˆåº¦ ğŸŸ¢
4. **ãƒ†ã‚¹ãƒˆç’°å¢ƒæœªæ§‹ç¯‰**
   - å¯¾ç­–: Phase 2ã§ Jest + Testing Library ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

5. **æœˆåˆãƒã‚±ãƒƒãƒˆè‡ªå‹•ä»˜ä¸ãƒãƒƒãƒæœªå®Ÿè£…**
   - ç¾çŠ¶: ç®¡ç†è€…ãŒæ‰‹å‹•ã§ä»˜ä¸
   - å¯¾ç­–: å°†æ¥ã®ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…

---

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### Phase 0ï¼ˆé€²è¡Œä¸­ï¼‰
- [x] é€²æ—ç®¡ç†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- [ ] ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ä½œæˆï¼ˆARCHITECTURE.mdï¼‰
- [ ] READMEæ›´æ–°

### Phase 1ï¼ˆæ¬¡ï¼‰
- [ ] ãƒã‚±ãƒƒãƒˆæœ‰åŠ¹æœŸé™ãƒã‚°ä¿®æ­£
- [ ] Worktreeãƒ–ãƒ©ãƒ³ãƒä½œæˆ: `fix/ticket-expiry`

### Phase 2-5
- è©³ç´°ã¯ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å‚ç…§: `/Users/yumakamiya/.claude/plans/mossy-seeking-swan.md`

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³](./ARCHITECTURE.md)
- [æ‰‹å‹•ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](./MANUAL_TEST.md)ï¼ˆæœªä½œæˆï¼‰
- [Google APIè¨­å®šæ‰‹é †](./GOOGLE_API_SETUP.md)ï¼ˆæœªä½œæˆï¼‰
- [ãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«](/Users/yumakamiya/.claude/plans/mossy-seeking-swan.md)
